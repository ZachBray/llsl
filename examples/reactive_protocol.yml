name: Reactive Protocol
version: 0.0.1
endianness: big

enums:
- name: Frame Type
  bits: 6
  cases:
  - name: Reserved
    value: 0x00
    description: Reserved
  - name: Setup
    value: 0x01
    description: Sent by client to initiate protocol processing.
  - name: Lease
    value: 0x02
    description: Sent by Responder to grant the ability to send requests.

codecs:

- name: Frame
  description: >-
    When using a transport protocol that does not provide compatible framing, the Frame Length MUST be prepended to the RSocket Frame.
  fields:
  - name: length
    type:
      kind: unsigned
      bits: 24
    description: >-
      Unsigned 24-bit integer representing the length of Frame in bytes.
      Excluding the Frame Length field.

- name: Frame Header
  description: >-
    RSocket frames begin with a RSocket Frame Header.
  fields:
  - name: Stream Id
    type:
      kind: unsigned
      padding: 1
      bits: 32
    description: >-
      Unsigned 31-bit integer representing the stream Identifier for this frame or
      0 to indicate the entire connection.

  - name: Frame Type
    type:
      kind: custom
      ref: Frame Type
    description: Type of Frame.

  - name: Ignore
    type:
      kind: bool
    description: Ignore frame if not understood

  - name: Metadata
    type:
      kind: bool
    description: Metadata present

- name: Setup
  description: >-
    The SETUP frame is sent by the client to inform the server of the parameters
    under which it desires to operate.
  fields:
  - name: Lease
    type:
      kind: bool
    description: Will honor LEASE (or not).

  - name: Major Version
    type:
      kind: unsigned
      bits: 16
      align: 16
    description: Unsigned 16-bit integer of Major version number of the protocol.
    new_line: true

  - name: Minor Version
    type:
      kind: unsigned
      bits: 16
    description: Unsigned 16-bit integer of Minor version number of the protocol.

  - name: Time Between KEEPALIVE Frames
    type:
      kind: unsigned
      padding: 1
      bits: 48 # TODO should be 32 but using this for testing
    description: >-
      Unsigned 31-bit integer of Time (in milliseconds) between KEEPALIVE frames
      that the client will send. Value MUST be > 0.

  - name: Max Lifetime
    type:
      kind: unsigned
      padding: 1
      bits: 48 # TODO should be 32
    description: >-
      Unsigned 31-bit integer of Time (in milliseconds) that a client will allow
      a server to not respond to a KEEPALIVE before it is assumed to be dead.
      Value MUST be > 0.
